<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>列表</title>
    <script src="js/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var page;
            var pageSize;
            var totalPage;
            var totalCount;
            var empData;

            var options = $("#select01").children();//选中的文本
            options[2].selected=true;


            var pageObj = new Object();
            pageObj.page=1;
            pageObj.pageSize=6;
            var query =JSON.stringify(pageObj);


            function listData(query){
                $.ajax({
                    type: "POST",
                    url: "/office/emp/list",
                    contentType: 'application/json; charset=UTF-8',
                    data: query,
                    dataType: "json",
                    success: function (data) {
                        ////

                        //1,将class=dynamicCreate1清空，清空之前生成的tr，因为不清空会导致再生成新的tr时，原来的tr依然存在
                        $(".dynamicCreate1").remove();
                        //在数据生成完成后，隐藏了页面上空行的tr，需要显示出来才能使用。
                        $("#dynamicCreate").show();
                        // 拿到页面上的tr 对象
                        var tr = $("#dynamicCreate");
                        // 拿到需要遍历的数据
                        // var newslabledatas =  data.datas;
                        var newslabledatas=data.list;
                        //遍历集合 index 是索引，item 是当前的对象

                        var pageSize2 = $('#select01 option:selected').val();

                        $.each(newslabledatas, function(index, item){

                            //克隆tr，每次遍历都可以产生新的tr，为了创建新的tr
                            var clonedTr = tr.clone();
                            //拿到新的tr，循环遍历它每一个td元素，并赋值  inner_index 是当前td 的索引
                            clonedTr.children("td").each(function(inner_index){
                                //根据索引为每一个td赋值
                                switch(inner_index){
                                    case(0):   // 判断是第一个 td ，就为其赋值

                                        $(this).html(pageSize2--);
                                        break;
                                    case(1):
                                        $(this).html(item.name);
                                        break;
                                    case(2):
                                        $(this).html(item.uname);
                                        break;
                                    case(3):
                                        if(typeof item.birthday == "undefined" || item.birthday == null || item.birthday == ""){
                                            $(this).html(0);
                                        }else{
                                            var age =jsGetAge(item.birthday);
                                            $(this).html(age);
                                        }


                                        break;
                                    case(4):
                                        if(item.level==1){
                                            $(this).html("王者");
                                        }else if(item.level==2){
                                            $(this).html("黄金");
                                        }else if(item.level==3){
                                            $(this).html("青铜");
                                        }else if(item.level==4){
                                            $(this).html("白银");
                                        }
                                        break;
                                    case(5):
                                        if(item.six==1){
                                            $(this).html("男");
                                        }else{
                                            $(this).html("女");
                                        }
                                        break;
                                    case(6):
                                        $(this).html(item.wages);
                                        break;
                                    case(7):
                                        $(this).html(item.hobby);
                                        break;
                                    case(8):
                                        $(this).html(item.mibiao);
                                        break;
                                    case(9):
                                        $(this).html(item.midaan);
                                        break;
                                    case(10):
                                        var time=item.eUpdate;
                                        var d = new Date(time);
                                        var times=d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
                                        $(this).html(times);
                                        break;
                                    case(11):
                                        var time=item.eAdd;
                                        var d = new Date(time);
                                        var times=d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
                                        $(this).html(times);
                                        break;
                                    case(12):
                                        var time=item.login;
                                        var d = new Date(time);
                                        var times=d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();
                                        $(this).html(times);
                                        break;
                                    case(13):
                                        $(this).html(item.dname);
                                        break;
                                    case(14):
                                        $(this).html(item.location);
                                        break;
                                    case(15):
                                        $(this).html(item.wei);
                                        break;
                                    case(16):

                                        // $(this).html("<a href=\"/add.html?type=update&id=bda5465225ea4f18bb5828543c58b1d3\">修改</a>");

                                        $(this).html("<button  onclick=\"updateEmp('"+item.id+"')\" type=\"button\" >修改</button>\n" +
                                            "<button  onclick=\"delEmp('"+item.id+"')\" type=\"button\" >删除</button>");



                                        break;



                                }//end switch
                            });//end children.each
                               //把克隆好的tr追加原来的tr后面 ，这样才能看见新的tr
                            clonedTr.insertAfter(tr);
                            // 将所有新生成的clonedTr ，既克隆出来的 tr 给予 class 属性，详情见   $(".dynamicCreate1").remove();的注释
                            clonedTr.attr("class","dynamicCreate1");
                        });//end $each
                        //隐藏id=clone的tr，因为该tr中的td没有数据，不隐藏起来会在生成的table第一行显示一个空行
                        $("#dynamicCreate").hide();
                        // 显示整个 table 表格
                        $("#table01").show();
                        // 下面的两条数据，主要是为 分页做准备的
                        // totalRows = data.totalRows;   // 总记录数
                        // pageNumber= data.pageNumber; // 当前页的页码

                        // pageNumber= data.pageNumber; // 当前页的页码
                        totalPage =data.totalPage;
                        totalCount =data.totalCount;
                        page=data.page;
                        pageSize=data.pageSize;
                        $("#totalPage").html(totalPage);
                        $("#totalPage2").html(totalPage);
                        $("#totalCount").html(totalCount);
                        if(totalPage==0){
                            $("#page").html(0);
                        }else{
                            $("#page").html(page);
                        }

                        $("#pageSize").html(pageSize);

                       // 分页栏的处理
                        if(totalPage<2){
                            $("#b1").attr("disabled",true);
                            $("#b2").attr("disabled",true);
                            $("#b3").attr("disabled",true);
                            $("#b4").attr("disabled",true);
                        }else if(page==1){
                            $("#b1").attr("disabled",true);
                            $("#b2").attr("disabled",true);
                            $("#b3").attr("disabled",false);
                            $("#b4").attr("disabled",false);
                        }else if(page<totalPage){
                            $("#b1").attr("disabled",false);
                            $("#b2").attr("disabled",false);
                            $("#b3").attr("disabled",false);
                            $("#b4").attr("disabled",false);
                        }else if(page==totalPage){
                            $("#b1").attr("disabled",false);
                            $("#b2").attr("disabled",false);
                            $("#b3").attr("disabled",true);
                            $("#b4").attr("disabled",true);
                        }


                        ////

                    }
                });

            }

            listData(query);


            $("#addEmp").click(function (obj) {
                window.location.href='add.html';
            });

            $("#logout").click(function (obj) {
                alert('退出成功');
                window.location.href='login.html';
                // $.ajax({
                //     type : "get",
                //     url : "/gateway/logout",
                //     success : function(data, status) {
                //
                //     }
                // });

            });




            $("#skipbt").click(function (obj) {
                var skipPage = $("#skipPage").val();

                var pageSize2 = $('#select01 option:selected').val();
                var dname = $('#q1 option:selected').val();
                var wei = $('#q2 option:selected').val();
                var location = $('#q3 option:selected').val();
                //年龄升序还是降序
                var age = $('#q4 option:selected').val();
                //创建时间（例五年以下）
                // var year = $('#q5 option:selected').val();
                //更新时间升序还是降序
                var uDateSort = $('#q6 option:selected').val();
                var level = $('#q7 option:selected').val();
                var six = $('#q8 option:selected').val();
                var hobby = $('#q9 option:selected').val();
                var uname = $('#q10').val();


                var obj = new Object();


                obj.page=skipPage;
                obj.pageSize=pageSize2;
                obj.dname=dname;
                obj.wei =wei;
                obj.location=location;
                obj.age=age;
                // obj.year=year;
                obj.uDateSort=uDateSort;
                obj.level=level;
                obj.six=six;
                obj.hobby=hobby;
                obj.uname=uname;


                var b2 =JSON.stringify(obj);
                listData(b2);


            });



            $(".pageClass").click(function (obj) {


                var pageSize = $('#select01 option:selected').val();
                var dname = $('#q1 option:selected').val();
                var wei = $('#q2 option:selected').val();
                var location = $('#q3 option:selected').val();
                //年龄升序还是降序
                var age = $('#q4 option:selected').val();
                //创建时间（例五年以下）
                // var year = $('#q5 option:selected').val();
                //更新时间升序还是降序
                var uDateSort = $('#q6 option:selected').val();
                var level = $('#q7 option:selected').val();
                var six = $('#q8 option:selected').val();
                var hobby = $('#q9 option:selected').val();
                var uname = $('#q10 option:selected').val();

                var obj = new Object();

                obj.pageSize=pageSize;
                obj.dname=dname;
                obj.wei =wei;
                obj.location=location;
                obj.age=age;
                // obj.year=year;
                obj.uDateSort=uDateSort;
                obj.level=level;
                obj.six=six;
                obj.hobby=hobby;
                obj.uname=uname;


                var opValue = $(this).attr("op");
                switch(opValue){
                    case("1"):   // 判断是第一个 td ，就为其赋值
                        page=1;
                        obj.page=page;
                        var b2 =JSON.stringify(obj);
                        listData(b2);
                        break;
                    case("2"):
                        page=page-1;
                        obj.page=page;
                        var b2 =JSON.stringify(obj);
                        listData(b2);
                        break;
                    case("3"):
                        page=page+1;
                        obj.page=page;
                        var b2 =JSON.stringify(obj);
                        listData(b2);
                        break;
                    case("4"):
                        page=totalPage;
                        obj.page=page;
                        var b2 =JSON.stringify(obj);
                        listData(b2);
                        break;
                }

            });

            function jsGetAge(strBirthday){
                var returnAge;
                // 根据生日计算年龄（"1995-09-25"）
                //以下五行是为了获取出生年月日，如果是从身份证上获取需要稍微改变一下
                var strBirthdayArr=strBirthday.split("-");
                var birthYear = strBirthdayArr[0];
                var birthMonth = strBirthdayArr[1];
                var birthDay = strBirthdayArr[2];

                d = new Date();
                var nowYear = d.getFullYear();
                var nowMonth = d.getMonth() + 1;
                var nowDay = d.getDate();

                if(nowYear == birthYear){
                    returnAge = 0;//同年 则为0岁
                }
                else{
                    var ageDiff = nowYear - birthYear ; //年之差
                    if(ageDiff > 0){
                        if(nowMonth == birthMonth) {
                            var dayDiff = nowDay - birthDay;//日之差
                            if(dayDiff < 0)
                            {
                                returnAge = ageDiff - 1;
                            }
                            else
                            {
                                returnAge = ageDiff ;
                            }
                        }
                        else
                        {
                            var monthDiff = nowMonth - birthMonth;//月之差
                            if(monthDiff < 0)
                            {
                                returnAge = ageDiff - 1;
                            }
                            else
                            {
                                returnAge = ageDiff ;
                            }
                        }
                    }
                    else
                    {
                        returnAge = -1;//返回-1 表示出生日期输入错误 晚于今天
                    }
                }

                return returnAge;//返回周岁年龄

            }

            $("#search").click(function (obj) {

                var pageSize2 = $('#select01 option:selected').val();
                var dname = $('#q1 option:selected').val();
                var wei = $('#q2 option:selected').val();
                var location = $('#q3 option:selected').val();
                //年龄升序还是降序
                var age = $('#q4 option:selected').val();
                //创建时间（例五年以下）
                // var year = $('#q5 option:selected').val();
                //更新时间升序还是降序
                var uDateSort = $('#q6 option:selected').val();
                var level = $('#q7 option:selected').val();
                var six = $('#q8 option:selected').val();
                var hobby = $('#q9 option:selected').val();
                var uname = $('#q10').val();


                var obj = new Object();

                obj.page=1;
                obj.pageSize=pageSize2;
                obj.dname=dname;
                obj.wei =wei;
                obj.location=location;
                obj.age=age;
                // obj.year=year;
                obj.uDateSort=uDateSort;
                obj.level=level;
                obj.six=six;
                obj.hobby=hobby;
                obj.uname=uname;


                var b2 =JSON.stringify(obj);
                listData(b2);
            });

            $("#clear").click(function (obj) {

                var q1 = $("#q1").children();
                q1[0].selected=true;
                var q2 = $("#q2").children();
                q2[0].selected=true;
                var q3 = $("#q3").children();
                q3[0].selected=true;
                var q4 = $("#q4").children();
                q4[0].selected=true;
                // var q5 = $("#q5").children();
                // q5[0].selected=true;
                var q6 = $("#q6").children();
                q6[0].selected=true;
                var q7 = $("#q7").children();
                q7[0].selected=true;
                var q8 = $("#q8").children();
                q8[0].selected=true;
                var q9 = $("#q9").children();
                q9[0].selected=true;

                $("#q10").val("");

            });



            $.ajax({
                type : "get",
                url : "/office/emp/getAll",
                success : function(data, status) {
                    var set = new Set();
                    $.each(data, function (index, item) {
                        set.add(item.hobby);
                    });
                    console.log(set);
                    for (var item of set) {
                        $("#q9").append(  //此处向select中循环绑定数据
                            "<option value=" + item + ">" + item + "</option>");
                    }
                }
            });

            $.ajax({
                type : "get",
                url : "/office/dept/getAll",
                success : function(data, status) {
                    var set = new Set();
                    $.each(data, function(index, item) {
                       set.add(item.name);
                    });
                    console.log(set);
                    for (var item of set) {
                        $("#q1").append(  //此处向select中循环绑定数据
                            "<option value="+item+">" + item+ "</option>");
                    }

                },
            });


            $.ajax({
                type : "get",
                url : "/office/dept/getAll",
                success : function(data, status) {
                    var set = new Set();
                    $.each(data, function(index, item) {
                        set.add(item.wei);
                    });
                    console.log(set);
                    for (var item of set) {
                        $("#q2").append(  //此处向select中循环绑定数据
                            "<option value="+item+">" + item+ "</option>");
                    }

                },
            });

            $.ajax({
                type : "get",
                url : "/office/dept/getAll",
                success : function(data, status) {
                    var set = new Set();
                    $.each(data, function(index, item) {
                        set.add(item.location);
                    });
                    console.log(set);
                    for (var item of set) {
                        $("#q3").append(  //此处向select中循环绑定数据
                            "<option value="+item+">" + item+ "</option>");
                    }

                },
            });







        });

        function updateEmp(a) {
            window.location.href='add.html?type=update&id='+a;
        }

        function delEmp(a) {
            var httpRequest = new XMLHttpRequest();
            httpRequest.open('DELETE', "/office/emp/emp/"+a, true);
            httpRequest.send();
            alert('删除成功');
            window.location.href='list.html';
        }



    </script>
</head>

<body>
<div style="width: 90%;height: 610px;margin: 0 auto">
    <form action="" method="post">
        你好！xxx
        <div style="width: 99%;height: 35px;margin: 50px 0 0 0">
            部门名称：
            <select id="q1" style="height:30px">
                <option value="-1">--请选择--</option>
            </select>
            部门大小：
            <select id="q2" style="height:30px">
                <option value="-1">--请选择--</option>
            </select>
            部门地点：
            <select id="q3" style="height:30px">
                <option value="-1">--请选择--</option>
            </select>
            年龄：
            <select id="q4" style="height:30px">
                <option value="-1">--请选择--</option>
                <option value="1">升序</option>
                <option value="2">降序</option>
            </select>
            更新时间：
            <select id="q6" style="height:30px">
                <option value="-1">--请选择--</option>
                <option value="1">升序</option>
                <option value="2">降序</option>
            </select>
            级别：
            <select id="q7" style="height:30px">
                <option value="-1">---请选择---</option>
                <option value="1">王者</option>
                <option value="2">黄金</option>
                <option value="3">青铜</option>
                <option value="4">白银</option>
            </select>
            性别：
            <select id="q8" style="height:30px">
                <option value="-1">---请选择---</option>
                <option value="1">男</option>
                <option value="2">女</option>
            </select>
            爱好：
            <select id="q9" style="height:30px;">
                <option value="-1">---请选择---</option>
            </select>
            员工姓名：<input id="q10" type="text" style="height:20px"/>
            <button type="button" id="search" >查询</button>
            <button type="button" id="clear" >重置</button>
            <button id="addEmp" type="button">新增</button>
            <!--<button type="button">修改密码</button>-->
            <button id="logout" type="button">注销</button>
        </div>
    </form>


    <table class="table01" id="table01" border="1" cellspacing="0" style="width:100%;text-align: center;margin: 40px auto">
        <tr >
            <td>编号</td>
            <td >账号</td>
            <td >姓名</td>
            <td >年龄</td>
            <td >级别</td>
            <td>性别</td>
            <td>工资</td>
            <td>爱好</td>
            <td>密保问题</td>
            <td>密保答案</td>
            <td>更新时间</td>
            <td>创建时间</td>
            <td>上一次登录时间</td>
            <td>部名称</td>
            <td>部地点</td>
            <td>部大小</td>
            <td>操作</td>
        </tr>
        <tr id="dynamicCreate">
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
            <td class="td07"></td>
        </tr>
        <tr>


            <td colspan="18">
                <form action="" method="post">
                    共<label id="totalPage"></label>页 &nbsp;&nbsp;<label id="page"></label>/<label id="totalPage2"></label> &nbsp;&nbsp;每页<label id="pageSize"></label>条 &nbsp;&nbsp;共<label id="totalCount"></label>条&nbsp;&nbsp;
                    <button id="b1" class="pageClass" op="1" type="button">首页</button><button class="pageClass" op="2" id="b2" type="button">上一页</button><button class="pageClass" op="3" id="b3" type="button">下一页</button><button class="pageClass" id="b4" op="4" type="button">尾页</button>
                    跳转到第<input type="text" id="skipPage" style="height:20px;width:60px">页
                    <button id="skipbt" type="button">跳转</button>
                    每页显示： <select id="select01" style="height:20px">
                    <option value="1">1</option>
                    <option value="3">3</option>
                    <option value="6">6</option>
                    <option value="8">8</option>
                </select>
                </form>
            </td>
        </tr>

    </table>

</div>
</div>
</body>
</html>